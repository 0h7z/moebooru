<% form_tag(:action => "create") do %>
  <%= hidden_field_tag "dmail[parent_id]", @dmail.parent_id || @dmail.id, :id => "dmail_parent_id" %>

  <table width="100%">
    <tfoot>
      <tr>
        <td></td>
        <td><%= submit_tag "Send" -%> <%= link_to 'Preview', '#', :id => 'dmail-preview' -%></td>
      </tr>
      <tr>
        <td></td>
        <td><div style="width: 400px" id="dmail-preview-area"></div></td>
      </tr>
    </tfoot>
    <tbody>
      <tr>
        <th><label for="dmail_to_name">To</label></th>
        <td><%= text_field_with_auto_complete "dmail", "to_name", {:value => params[:to]}, :skip_style => true, :min_chars => 3, :skip_style => true %></td>
      </tr>
      <tr>
        <th><label for="dmail_title">Title</label></th>
        <td><%= text_field "dmail", "title" %></td>
      </tr>
      <tr>
        <th><label for="dmail_body">Body</label></th>
        <td><%= text_area "dmail", "body", :size => "50x25", :class => "default" %></td>
      </tr>
    </tbody>
  </table>
<% end %>
<script type="text/javascript">
  $('dmail-preview').observe('click', function(event) {
    new Ajax.Updater('dmail-preview-area', '/dmail/preview', { parameters: 'body=' + encodeURIComponent($('dmail_body').value) });
    event.stop(); //Stop the browser from actually going to href.
  });
</script>
