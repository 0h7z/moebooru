<!DOCTYPE html>
<html class="action-<%= params[:controller] %> action-<%= params[:controller] %>-<%= params[:action] %> hide-advanced-editing">
<head>
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
  <title><%= @page_title %></title>
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="top" title="<%= CONFIG["app_name"] %>" href="/">

  <%# The javascript-hide class is used to hide elements (eg. blacklisted posts) from JavaScript. %>
  <script type="text/javascript">
    var css = ".javascript-hide { display: none !important; }";
    var style = document.createElement("style"); style.type = "text/css";
    if(style.styleSheet) // IE
      style.styleSheet.cssText = css;
    else
      style.appendChild(document.createTextNode(css));
    document.getElementsByTagName("head")[0].appendChild(style);
  </script>

  <%= yield :html_header %>
  <%= auto_discovery_link_tag :atom, :controller => "post", :action => "atom", :tags => params[:tags] %>
  <%= stylesheet_link_tag :application %>

  <%= javascript_include_tag :application %>
  <!--[if lt IE 8]>
  <script src="/IE8.js" type="text/javascript"></script>
  <![endif]-->
  <%= CONFIG["custom_html_headers"] %>
  <!--[if lt IE 7]>
    <style type="text/css">
      body div#post-view > div#right-col > div > div#note-container > div.note-body {
        overflow: visible;
      }
    </style>
    <script src="<%= request.protocol %>ie7-js.googlecode.com/svn/trunk/lib/IE7.js" type="text/javascript"></script>
  <![endif]-->
</head>
<body>
  <%= render 'layouts/news' %> 
  <div id="header">
    <div id="title"><h2 id="site-title"><%= image_tag('logo_small.png', :alt => CONFIG['app_name'], :size=> '484x75', :id => 'logo') %><span><%= tag_header(params[:tags]) %></span></h2></div>
    <%= render :partial => "layouts/menu" %>
  </div>
  <%= render :partial => "layouts/login" %>

  <% if CONFIG["server_host"] == "yande.re" %>
    <%# This is actually just to keyword "image board" and "danbooru" for searches like
        "tinkle danbooru".  Be careful, this looks very stupid in search results if taken
        too far: "Sex hentai porn danbooru image board"; this should hint search engines,
        not spam them. %>
    <div style="display: none;">Danbooru-based image board with a specialization in high-quality images.</div>
  <% end %>

  <!--[if lt IE 7]>
  <div style="display: none;" id="old-browser"><%=t :old_browser %>
    <%=t :old_browser2 %>
    <a href="http://www.mozilla.com/firefox/">Firefox</a>,
    <a href="http://www.opera.com/">Opera</a>,
    <a href="http://www.microsoft.com/windows/internet-explorer/download-ie.aspx">Internet Explorer</a>.
    <div style="text-align: right;" id="old-browser-hide">
      <a href="#" onclick='$("old-browser").hide(); Cookie.put("hide-ie-nag", "1");'><%=t :old_browser3 %></a>
    </div>
  </div>
  <![endif]-->
  <%= render :partial => "layouts/notice" %>

  <div class="blocked" id="block-reason" style="display: none;">
  </div>

  <div id="content">
    <%= yield %>
    <% if content_for? :subnavbar %>
      <div class="footer">
        <%= yield :above_footer %>
        <ul class="flat-list" id="subnavbar">
          <%= yield :subnavbar %>
        </ul>
      </div>
    <% end %>
  </div>

  <script type="text/javascript">
    Cookie.setup()
    InitTextAreas();
    InitAdvancedEditing();
    Post.InitBrowserLinks();
    if(TagCompletion)
      TagCompletion.init(<%= json_escape Tag.get_summary_version.to_json.html_safe %>);
  </script>

  <!--[if lt IE 7]>
    <script type="text/javascript">
      if(Cookie.get("hide-ie-nag") != "1")
        $("old-browser").show();
    </script>
  <![endif]-->
  <%= yield :post_cookie_javascripts %>

  <%= render 'shared/ga' if CONFIG['ga-tracking-id'] -%>
</body>
</html>
